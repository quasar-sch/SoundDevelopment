<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚˜ì˜ ë°œë‹¬ ì¢…í•© ì‹œë®¬ë ˆì´í„°</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #222;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background: radial-gradient(circle at top left, #fdf3e7, #f0f6ff);
    }

    .app {
      width: 100%;
      max-width: 980px;
      margin: 24px;
      background: #ffffffee;
      border-radius: 20px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.08);
      padding: 22px 20px 26px;
    }

    header {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 14px;
    }

    .hero-image {
      width: 68px;
      height: 68px;
      border-radius: 50%;
      background: conic-gradient(from 180deg, #4b8cf5, #81c784, #ffb74d, #ba68c8, #4b8cf5);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
      flex-shrink: 0;
    }

    .hero-image span {
      font-size: 40px;
      background: #fff;
      width: 54px;
      height: 54px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .title-block h1 {
      margin: 0;
      font-size: 24px;
    }
    .title-block .subtitle {
      margin-top: 4px;
      font-size: 13px;
      color: #555;
    }

    .stepper {
      margin: 10px 0 16px;
    }
    .stepper-bar {
      position: relative;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e0e6f2;
      overflow: hidden;
    }
    .stepper-progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: linear-gradient(90deg, #4b8cf5, #81c784);
      width: 0%;
      transition: width 0.2s ease-out;
    }
    .stepper-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 11px;
      color: #666;
    }
    .stepper-label {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .stepper-badge {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid #cbd4ea;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: #fff;
      color: #777;
    }
    .stepper-badge.active {
      border-color: #4b8cf5;
      background: #4b8cf5;
      color: #fff;
    }

    .screen {
      display: none;
      margin-top: 4px;
    }
    .screen.active {
      display: block;
    }

    .guide-bubble {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 13px;
      color: #444;
    }
    .guide-icon {
      font-size: 20px;
    }
    .guide-text {
      background: #f4f7ff;
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid #dde4fb;
    }

    h2 {
      margin: 4px 0 6px;
      font-size: 18px;
    }
    .desc {
      font-size: 13px;
      color: #555;
      margin-bottom: 8px;
    }

    /* Step 1 */
    .domain-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 6px;
    }
    .domain-card {
      background: #fff;
      border-radius: 16px;
      border: 1px solid #e2e6f4;
      padding: 10px 11px 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
    }
    .domain-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .domain-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 600;
    }
    .domain-chip {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #edf2ff;
      color: #3c4a8a;
    }
    .domain-questions {
      margin-top: 4px;
      font-size: 13px;
    }
    .question-row {
      display: flex;
      gap: 6px;
      align-items: flex-start;
      padding: 3px 0;
    }
    .question-row input {
      margin-top: 3px;
    }

    /* Step 2 */
    .quiz-card {
      background: #fff;
      border-radius: 18px;
      border: 1px solid #e1e3f0;
      padding: 14px 14px 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.05);
      margin-top: 4px;
    }
    .quiz-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 12px;
      color: #666;
    }
    .quiz-tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fdf0ff;
      color: #8a3aa8;
    }
    .quiz-question {
      font-size: 14px;
      white-space: pre-line;
      margin-bottom: 10px;
    }
    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .option-card {
      border-radius: 999px;
      border: 1px solid #dde1f0;
      padding: 6px 10px;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      gap: 6px;
      align-items: center;
      background: #fafbff;
      transition: border-color 0.15s ease, background 0.15s ease, transform 0.08s ease;
    }
    .option-card span.label {
      font-weight: 600;
      color: #555;
    }
    .option-card:hover {
      border-color: #b8c3f5;
      transform: translateY(-1px);
    }
    .option-card.selected {
      border-color: #4b8cf5;
      background: #eaf1ff;
    }
    .quiz-progress-dots {
      margin-top: 8px;
      text-align: center;
      font-size: 11px;
      color: #666;
    }

    /* Step 3 */
    .habit-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 10px;
      margin-top: 6px;
    }
    .habit-category {
      background: #fff;
      border-radius: 16px;
      border: 1px solid #e3e7f3;
      padding: 8px 10px 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
      font-size: 13px;
    }
    .habit-cat-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .habit-item {
      margin-top: 6px;
    }
    .habit-text {
      margin-bottom: 4px;
    }
    .habit-scale {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }
    .habit-btn {
      border-radius: 999px;
      border: 1px solid #d4d9ea;
      padding: 3px 8px;
      font-size: 12px;
      background: #f7f8fd;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease;
    }
    .habit-btn.selected {
      background: #4b8cf5;
      border-color: #4b8cf5;
      color: #fff;
    }
    .habit-summary {
      margin-top: 10px;
      background: #f5f8ff;
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid #dce4ff;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
    }

    /* Step 4 */
    .result-card {
      margin-top: 6px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 28px rgba(0,0,0,0.08);
      background: #fff;
    }
    .result-header-strip {
      height: 42px;
      background: linear-gradient(90deg, #4b8cf5, #81c784, #ffb74d, #ba68c8);
    }
    .result-body {
      padding: 14px 16px 16px;
    }
    .result-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }
    .result-title-row h3 {
      margin: 0;
      font-size: 18px;
    }
    .result-subtag {
      font-size: 11px;
      color: #666;
    }
    .name-row {
      margin-bottom: 8px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .name-row input {
      border-radius: 999px;
      border: 1px solid #d5dae9;
      padding: 3px 8px;
      font-size: 12px;
      min-width: 120px;
    }

    .domain-bars {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
      margin-bottom: 10px;
      font-size: 12px;
    }
    .domain-bar-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .dot-row {
      letter-spacing: 1px;
      font-size: 13px;
    }

    .analysis-box {
      margin-top: 6px;
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 12px;
      line-height: 1.6;
      background: #f8faff;
      border-left: 4px solid #4b8cf5;
      white-space: pre-line;
    }
    .analysis-box.secondary {
      border-left-color: #81c784;
      background: #f7fff8;
    }

    .strengths-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 8px;
      margin-top: 8px;
      font-size: 12px;
    }
    .strength-box {
      border-radius: 12px;
      padding: 8px 10px;
      background: #f3fbf5;
      border: 1px solid #cde7d4;
      white-space: pre-line;
    }
    .improve-box {
      border-radius: 12px;
      padding: 8px 10px;
      background: #fff7ec;
      border: 1px solid #ffd4a6;
      white-space: pre-line;
    }

    .prompt-area {
      margin-top: 10px;
      font-size: 12px;
    }
    .prompt-area p {
      margin: 4px 0 6px;
      color: #555;
    }
    textarea {
      width: 100%;
      min-height: 80px;
      border-radius: 10px;
      border: 1px solid #d3daea;
      padding: 8px;
      font-size: 12px;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    #copyStatus {
      font-size: 11px;
      color: #555;
      margin-top: 4px;
    }

    /* Buttons & footer */
    .footer-row {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
      color: #555;
    }
    .footer-left {
      max-width: 60%;
    }
    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 7px 15px;
      font-size: 13px;
      cursor: pointer;
      background: #4b8cf5;
      color: #fff;
      box-shadow: 0 4px 10px rgba(75,140,245,0.4);
      transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.08s ease;
    }
    button:hover {
      background: #3a78dd;
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(75,140,245,0.45);
    }
    button.secondary {
      background: #e3e7f2;
      color: #333;
      box-shadow: none;
    }
    button.secondary:hover {
      background: #d4d9ec;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    @media (max-width: 640px) {
      .app {
        margin: 14px;
        padding: 18px 14px 22px;
      }
      header {
        align-items: flex-start;
      }
      .footer-left {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="hero-image">
      <span>ğŸ§’</span>
    </div>
    <div class="title-block">
      <h1>ë‚˜ì˜ ë°œë‹¬ ì¢…í•© ì‹œë®¬ë ˆì´í„°</h1>
      <div class="subtitle">5í•™ë…„ ì‹¤ê³¼ &lt;ë‚˜ì˜ ë°œë‹¬&gt; ë‹¨ì›ì„ ë°”íƒ•ìœ¼ë¡œ, ë‚˜ì˜ ì„±ì¥ê³¼ ìƒí™œìŠµê´€ì„ ëŒì•„ë³´ëŠ” ìê¸° í‰ê°€ ë„êµ¬ì…ë‹ˆë‹¤.</div>
    </div>
  </header>

  <div class="stepper">
    <div class="stepper-bar">
      <div class="stepper-progress" id="stepProgress"></div>
    </div>
    <div class="stepper-labels">
      <div class="stepper-label">
        <div class="stepper-badge" data-step-badge="1">1</div> ë‚˜ì˜ ë³€í™”
      </div>
      <div class="stepper-label">
        <div class="stepper-badge" data-step-badge="2">2</div> ë°œë‹¬ ì´í•´ í€´ì¦ˆ
      </div>
      <div class="stepper-label">
        <div class="stepper-badge" data-step-badge="3">3</div> ìƒí™œìŠµê´€ ì ê²€
      </div>
      <div class="stepper-label">
        <div class="stepper-badge" data-step-badge="4">4</div> ê²°ê³¼ ì¹´ë“œ
      </div>
    </div>
  </div>

  <!-- STEP 1 -->
  <section id="screen-step1" class="screen active">
    <div class="guide-bubble">
      <div class="guide-icon">ğŸ£</div>
      <div class="guide-text">ì§€ë‚œ 1ë…„ ë™ì•ˆ ë‹¬ë¼ì§„ ë‚˜ì˜ ëª¨ìŠµì„ ë– ì˜¬ë¦¬ë©´ì„œ, í•´ë‹¹ë˜ëŠ” ë¬¸ì¥ì„ ì²´í¬í•´ ë³´ì„¸ìš”.</div>
    </div>
    <h2>1ë‹¨ê³„. ì§€ë‚œ 1ë…„ ë™ì•ˆ, ë‚˜ëŠ” ì–´ë–»ê²Œ ìëì„ê¹Œ?</h2>
    <div class="desc">ì‹ ì²´, ìƒê°, ê°ì •, ì¹œêµ¬ ê´€ê³„ì—ì„œ ëŠë¼ëŠ” ë³€í™”ë¥¼ ê³¨ê³ ë£¨ ì‚´í´ë³´ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.</div>

    <div class="domain-grid" id="domainGrid"></div>
  </section>

  <!-- STEP 2 -->
  <section id="screen-step2" class="screen">
    <div class="guide-bubble">
      <div class="guide-icon">ğŸ§©</div>
      <div class="guide-text">ì—¬ëŸ¬ ìƒí™©ì—ì„œ ì–´ë–¤ ì„ íƒì´ ë‚˜ì™€ ì¹œêµ¬ì—ê²Œ ë„ì›€ì´ ë˜ëŠ”ì§€ ìƒê°í•´ ë³´ì„¸ìš”.</div>
    </div>
    <h2>2ë‹¨ê³„. ì´ëŸ° ìƒí™©ì—ì„œ ë‚˜ëŠ” ì–´ë–»ê²Œ í–‰ë™í• ê¹Œ?</h2>
    <div class="desc">ì•„ë™ê¸°ì˜ ë°œë‹¬ì„ ë°”ë¥´ê²Œ ì´í•´í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ëŠ” ì§§ì€ í€´ì¦ˆì…ë‹ˆë‹¤.</div>

    <div id="quizCard" class="quiz-card"></div>
    <div class="quiz-progress-dots" id="quizDots"></div>
  </section>

  <!-- STEP 3 -->
  <section id="screen-step3" class="screen">
    <div class="guide-bubble">
      <div class="guide-icon">ğŸŒ±</div>
      <div class="guide-text">ê±´ê°•í•œ ë°œë‹¬ì„ ìœ„í•´ ì§€ê¸ˆì˜ ìƒí™œìŠµê´€ì´ ì–´ë–¤ì§€ ì†”ì§í•˜ê²Œ ì²´í¬í•´ ë³´ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.</div>
    </div>
    <h2>3ë‹¨ê³„. ë‚˜ì˜ ìƒí™œìŠµê´€ ì ê²€</h2>
    <div class="desc">í‰ì†Œ ìƒí™œì—ì„œ ì–¼ë§ˆë‚˜ ìì£¼ ê·¸ë ‡ê²Œ í•˜ëŠ”ì§€ ê³¨ë¼ ë³´ì„¸ìš”. ì •ë‹µÂ·ì˜¤ë‹µì´ ì•„ë‹ˆë¼, ë‚˜ë¥¼ ëŒì•„ë³´ëŠ” í™œë™ì…ë‹ˆë‹¤.</div>

    <div class="habit-grid" id="habitGrid"></div>

    <div class="habit-summary">
      <div>í˜„ì¬ê¹Œì§€ ì¶”ì • ìƒí™œìŠµê´€ ì ìˆ˜: <span id="habitScorePreview">0</span> / 28</div>
      <div id="habitLevelText"></div>
    </div>
  </section>

  <!-- STEP 4 -->
  <section id="screen-step4" class="screen">
    <div class="guide-bubble">
      <div class="guide-icon">ğŸ“‹</div>
      <div class="guide-text">ì§€ê¸ˆê¹Œì§€ì˜ ë‹µì„ ë°”íƒ•ìœ¼ë¡œ, ë‚˜ë§Œì˜ &lt;ë‚˜ì˜ ë°œë‹¬ ì¹´ë“œ&gt;ë¥¼ ë§Œë“¤ì–´ ë³´ì•˜ì–´ìš”.</div>
    </div>
    <h2>4ë‹¨ê³„. ë‚˜ì˜ ë°œë‹¬ ì¹´ë“œ</h2>
    <div class="desc">í•„ìš”í•˜ë‹¤ë©´ ì´ë¦„ì„ ì ê³ , ë‚´ìš©ì„ ì½ì–´ ë³´ë©° ë‚˜ì˜ ê°•ì ê³¼ ì•ìœ¼ë¡œì˜ ëª©í‘œë¥¼ ìƒê°í•´ ë³´ì„¸ìš”.</div>

    <div class="result-card">
      <div class="result-header-strip"></div>
      <div class="result-body">
        <div class="result-title-row">
          <h3>ë‚˜ì˜ ë°œë‹¬ ì¹´ë“œ</h3>
          <div class="result-subtag">5í•™ë…„ ì‹¤ê³¼ Â· ë‚˜ì˜ ë°œë‹¬</div>
        </div>
        <div class="name-row">
          ì´ë¦„: <input type="text" id="studentNameInput" placeholder="ì´ë¦„ì„ ì ì–´ ë³´ì„¸ìš” (ì„ íƒ)" />
        </div>

        <div class="domain-bars" id="domainBars"></div>

        <div class="analysis-box" id="domainAnalysis"></div>
        <div class="analysis-box secondary" id="understandingAnalysis"></div>
        <div class="analysis-box" id="habitAnalysis"></div>

        <div class="strengths-row">
          <div class="strength-box">
            <strong>â­ ë‚˜ì˜ ê°•ì  3ê°€ì§€</strong>
            <div id="strengthList"></div>
          </div>
          <div class="improve-box">
            <strong>ğŸ”§ ë³´ì™„í•˜ë©´ ì¢‹ì€ ì  2ê°€ì§€</strong>
            <div id="improveList"></div>
          </div>
        </div>

        <div class="prompt-area">
          <strong>ğŸ–¼ AIë¡œ ë‚˜ì˜ ë°œë‹¬ ìºë¦­í„° ê·¸ë ¤ë³´ê¸°</strong>
          <p>ì•„ë˜ í”„ë¡¬í”„íŠ¸ë¥¼ ë³µì‚¬í•´ì„œ ChatGPT ì´ë¯¸ì§€ ë§Œë“¤ê¸° ê¸°ëŠ¥ì— ë¶™ì—¬ë„£ìœ¼ë©´, ë‚˜ì˜ ëª¨ìŠµì„ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <textarea id="imagePrompt" readonly></textarea>
          <div class="btn-row" style="margin-top:6px;">
            <button class="secondary" id="btnCopyPrompt">í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
            <div id="copyStatus"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER: navigation -->
  <div class="footer-row">
    <div class="footer-left">
      <span id="stepHint">1ë‹¨ê³„: ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í†µí•´ ë‚˜ì˜ ë³€í™”ë¥¼ ì‚´í´ë³´ëŠ” ì¤‘ì…ë‹ˆë‹¤.</span>
    </div>
    <div class="btn-row">
      <button class="secondary" id="btnPrev" disabled>â—€ ì´ì „ ë‹¨ê³„</button>
      <button id="btnNext">ë‹¤ìŒ ë‹¨ê³„ë¡œ â–¶</button>
    </div>
  </div>
</div>

<script>
  // ====== ë°ì´í„° ì •ì˜ ======

  const stepCount = 4;
  let currentStep = 1;

  // Step 1 ì§ˆë¬¸
  const step1Questions = [
    // physical
    { id: 1, domain: "physical", text: "í‚¤ë‚˜ ëª¸ë¬´ê²Œê°€ ì˜ˆì „ë³´ë‹¤ ë§ì´ ìë€ ê²ƒ ê°™ë‹¤." },
    { id: 2, domain: "physical", text: "ë‹¬ë¦¬ê¸°, ì¤„ë„˜ê¸°, ì²´ìœ¡ í™œë™ì„ í•  ë•Œ ì˜ˆì „ë³´ë‹¤ ëœ í˜ë“¤ë‹¤." },
    { id: 3, domain: "physical", text: "ë¬´ê±°ìš´ ë¬¼ê±´ì„ ë“¤ê±°ë‚˜, ì˜¤ë˜ ì„œ ìˆëŠ” ê²ƒì´ ì˜ˆì „ë³´ë‹¤ ì‰¬ì›Œì¡Œë‹¤." },
    { id: 4, domain: "physical", text: "ëª¸ì´ ìë¼ëŠ” ê²ƒì— ê´€ì‹¬ì´ ìƒê¸°ê³ , ë‚´ ê±´ê°•ì— ëŒ€í•´ ë” ìƒê°í•˜ê²Œ ë˜ì—ˆë‹¤." },
    // cognitive
    { id: 5, domain: "cognitive", text: "ê¸€ì´ë‚˜ ë¬¸ì œì˜ ë‚´ìš©ì„ ì´í•´í•˜ëŠ” ì†ë„ê°€ ì˜ˆì „ë³´ë‹¤ ë¹¨ë¼ì§„ ê²ƒ ê°™ë‹¤." },
    { id: 6, domain: "cognitive", text: "ë¬¸ì œë¥¼ í•´ê²°í•  ë•Œ í•œ ê°€ì§€ ë°©ë²•ë³´ë‹¤ ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì„ ë– ì˜¬ë¦´ ìˆ˜ ìˆë‹¤." },
    { id: 7, domain: "cognitive", text: "ë‰´ìŠ¤ë‚˜ ì‚¬íšŒ ë¬¸ì œë¥¼ ë“¤ì—ˆì„ ë•Œ, ë‚´ ìƒê°ì„ ë§í•´ ë³´ê³  ì‹¶ë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤." },
    { id: 8, domain: "cognitive", text: "ê³„íšì„ ì„¸ìš°ê³  ìˆœì„œë¥¼ ì •í•´ ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ì¼ì´ ì˜ˆì „ë³´ë‹¤ ìµìˆ™í•´ì¡Œë‹¤." },
    // emotional
    { id: 9, domain: "emotional", text: "â€œê¸°ì˜ë‹¤/ìŠ¬í”„ë‹¤â€ë¿ë§Œ ì•„ë‹ˆë¼, ì–µìš¸í•˜ë‹¤Â·ë¶€ë„ëŸ½ë‹¤Â·ê±±ì •ëœë‹¤ ê°™ì€ ì—¬ëŸ¬ ê°ì •ì„ ëŠë‚€ë‹¤." },
    { id: 10, domain: "emotional", text: "ê°ì •ì´ ë„ˆë¬´ ì‹¬í•´ì§€ê¸° ì „ì—, ìŠ¤ìŠ¤ë¡œë¥¼ ì°¨ë¶„í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ ë…¸ë ¥í•´ ë³¸ ì ì´ ìˆë‹¤." },
    { id: 11, domain: "emotional", text: "ì¹œêµ¬ë‚˜ ê°€ì¡±ì´ ì–´ë–¤ ê°ì •ì„ ëŠë¼ëŠ”ì§€ ì§ì‘í•˜ê³ , ê·¸ ë§ˆìŒì„ ì´í•´í•´ ë³´ë ¤ê³  í•œë‹¤." },
    { id: 12, domain: "emotional", text: "í™”ê°€ ë‚˜ë„, ë¬¼ê±´ì„ ë˜ì§€ê±°ë‚˜ ì†Œë¦¬ë¥¼ ì§€ë¥´ê¸°ë³´ë‹¤ ë§ë¡œ í‘œí˜„í•˜ë ¤ê³  ë…¸ë ¥í•´ ë³¸ ì ì´ ìˆë‹¤." },
    // social
    { id: 13, domain: "social", text: "ì¹œêµ¬ì™€ì˜ ê´€ê³„ê°€ ì˜ˆì „ë³´ë‹¤ ë” ì¤‘ìš”í•˜ê²Œ ëŠê»´ì§„ë‹¤." },
    { id: 14, domain: "social", text: "ëª¨ë‘  í™œë™ì´ë‚˜ ë‹¨ì²´ ë†€ì´ì—ì„œ, ë‹¤ë¥¸ ì‚¬ëŒì˜ ì˜ê²¬ì„ ë“¤ì–´ ë³´ë ¤ê³  í•œë‹¤." },
    { id: 15, domain: "social", text: "ì¹œêµ¬ì™€ ë‹¤íˆ° ì ì´ ìˆì„ ë•Œ, ê·¸ëƒ¥ ë„˜ê¸°ê¸°ë³´ë‹¤ ëŒ€í™”ë¥¼ í†µí•´ í•´ê²°í•´ ë³´ë ¤ê³  í•œ ì ì´ ìˆë‹¤." },
    { id: 16, domain: "social", text: "ë‚´ê°€ í•œ ë§ì´ë‚˜ í–‰ë™ì´ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì–´ë–¤ ê¸°ë¶„ì„ ì¤„ì§€ ìƒê°í•´ ë³¸ ì ì´ ìˆë‹¤." }
  ];

  const domainsMeta = {
    physical: { label: "ì‹ ì²´ ë°œë‹¬", emoji: "ğŸ’ª", color: "#ffb74d" },
    cognitive: { label: "ì¸ì§€ ë°œë‹¬", emoji: "ğŸ§ ", color: "#81c784" },
    emotional: { label: "ì •ì„œ ë°œë‹¬", emoji: "ğŸ’–", color: "#ba68c8" },
    social: { label: "ì‚¬íšŒì„± ë°œë‹¬", emoji: "ğŸ¤", color: "#4fc3f7" }
  };

  // Step 2 í€´ì¦ˆ
  const step2Questions = [
    {
      tag: "ê°œì¸ì°¨ Â· ì‹ ì²´ ë°œë‹¬",
      text:
"ë¯¼ìˆ˜ì™€ ì§€í›ˆì´ëŠ” ê°™ì€ ë°˜ ì¹œêµ¬ì…ë‹ˆë‹¤.\në¯¼ìˆ˜ëŠ” ë˜ë˜ë³´ë‹¤ í‚¤ê°€ ë¹¨ë¦¬ í¬ëŠ” í¸ì´ê³ , ì§€í›ˆì´ëŠ” ì•„ì§ í‚¤ê°€ ë§ì´ ìë¼ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì§€í›ˆì´ëŠ” â€œë‚œ ì™œ ì´ë ‡ê²Œ í‚¤ê°€ ì•ˆ í¬ì§€â€¦ ë­”ê°€ ì´ìƒí•œ ê±° ì•„ë‹ê¹Œ?â€ í•˜ê³  ê±±ì •í•©ë‹ˆë‹¤.\nì´ë•Œ ì§€í›ˆì´ê°€ ìƒê°í•˜ê±°ë‚˜ í–‰ë™í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ê°€ì¥ ì•Œë§ì€ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?",
      options: [
        "â€œë‚˜ëŠ” ë­”ê°€ ì˜ëª»ëœ ê²ƒ ê°™ì•„. ì¹œêµ¬ë“¤ì´ë‘ ë¹„êµí•˜ë©´ ë„ˆë¬´ ì†ìƒí•´.â€ë¼ê³  ìƒê°í•˜ë©°, ê³„ì† ìê¸° í‚¤ë¥¼ íƒ“í•œë‹¤.",
        "â€œì‚¬ëŒë§ˆë‹¤ ìë¼ëŠ” ì†ë„ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆì–´. ê·œì¹™ì ìœ¼ë¡œ ìê³ , ì˜ ë¨¹ê³ , ìš´ë™í•˜ë©´ì„œ ë‚´ ëª¸ì„ ì˜ ê´€ë¦¬í•´ ë´ì•¼ì§€.â€ë¼ê³  ìƒê°í•œë‹¤.",
        "â€œí‚¤ê°€ ì‘ì€ ê²Œ ë„ˆë¬´ ì‹«ì–´. ì ì‹¬ì„ ê±°ì˜ ë¨¹ì§€ ì•Šê³  ë‹¤ì´ì–´íŠ¸ë¥¼ í•´ì•¼ê² ë‹¤.â€ê³  ê²°ì‹¬í•œë‹¤."
      ],
      correct: 1
    },
    {
      tag: "ì‹ ì²´ ë†€ë¦¼ ê¸ˆì§€",
      text:
"ì–´ëŠ ë‚ , ì§€ì€ì´ëŠ” ì¹œêµ¬ ìˆ˜ì•„ê°€ ì˜ˆì „ë³´ë‹¤ í‚¤ë„ í¬ê³  ëª¸ë„ ë‹¬ë¼ì§„ ê²ƒ ê°™ë‹¤ê³  ëŠê¼ˆìŠµë‹ˆë‹¤.\nëª‡ëª‡ ì¹œêµ¬ë“¤ì€ â€œì•¼, ë„ˆ ì™œ ì´ë ‡ê²Œ ë‹¬ë¼ì¡Œì–´? ì´ìƒí•´~â€ë¼ê³  ì¥ë‚œì„ ì¹˜ë©° ë†€ë¦½ë‹ˆë‹¤.\nì´ë•Œ ì§€ì€ì´ê°€ í•´ì•¼ í•  í–‰ë™ìœ¼ë¡œ ê°€ì¥ ë°”ëŒì§í•œ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?",
      options: [
        "ê°™ì´ ì›ƒìœ¼ë©´ì„œ â€œë§ì•„, ë„ˆ ìš”ì¦˜ ì¢€ ì´ìƒí•´.â€ë¼ê³  ë§í•˜ë©° ë¶„ìœ„ê¸°ë¥¼ ë§ì¶° ì¤€ë‹¤.",
        "â€œê·¸ë§Œí•´. ëª¸ì´ ìë¼ëŠ” ê±´ ëˆ„êµ¬ì—ê²Œë‚˜ ì¼ì–´ë‚˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì¼ì´ì•¼.â€ë¼ê³  ë§í•˜ë©°, ì¹œêµ¬ë¥¼ ë†€ë¦¬ì§€ ë§ë¼ê³  í•œë‹¤.",
        "ê·¸ëƒ¥ ëª¨ë¥¸ ì²™ ì¡°ìš©íˆ ìˆê³ , ì†ìœ¼ë¡œë§Œ â€˜ë¶ˆí¸í•˜ë‹¤â€™ê³  ìƒê°í•œë‹¤."
      ],
      correct: 1
    },
    {
      tag: "ì •ì„œ Â· ê°ì • ì¡°ì ˆ",
      text:
"ì£¼ì›ì´ëŠ” ë°œí‘œ ì‹œê°„ì— ì¹œêµ¬ê°€ í‹€ë¦° ë¶€ë¶„ì„ ì§€ì í•˜ì,\nì°½í”¼í•˜ê¸°ë„ í•˜ê³ , í™”ë„ ë‚˜ê³ , ì–µìš¸í•œ ë§ˆìŒë„ ë“¤ì—ˆìŠµë‹ˆë‹¤.\nì£¼ì›ì´ëŠ” ì´ëŸ° ê°ì •ì„ ì–´ë–»ê²Œ ë‹¤ë£¨ë©´ ì¢‹ì„ê¹Œìš”?",
      options: [
        "ê·¸ ìë¦¬ì—ì„œ í¬ê²Œ ì†Œë¦¬ë¥¼ ì§€ë¥´ê³ , ì¹œêµ¬ì—ê²Œ ìš•ì„ í•´ì„œ ë§ˆìŒì„ í’€ì–´ ë²„ë¦°ë‹¤.",
        "â€œì§€ê¸ˆ ì—¬ëŸ¬ ê°ì •ì´ ì„ì—¬ ìˆêµ¬ë‚˜.â€ í•˜ê³  ìŠ¤ìŠ¤ë¡œë¥¼ ëŒì•„ë³¸ ë’¤, ë‚˜ì¤‘ì— ì°¨ë¶„í•´ì¡Œì„ ë•Œ ì¹œêµ¬ì™€ ì´ì•¼ê¸°í•˜ê±°ë‚˜, ì„ ìƒë‹˜ê»˜ ë„ì›€ì„ ìš”ì²­í•œë‹¤.",
        "ì´ëŸ° ê°ì •ì„ ëŠë¼ëŠ” ê±´ ì˜ëª»ëë‹¤ê³  ìƒê°í•˜ë©°, ì•„ë¬´ ê°ì •ë„ ëŠë¼ì§€ ì•Šìœ¼ë ¤ê³  ì• ì“´ë‹¤."
      ],
      correct: 1
    },
    {
      tag: "ìƒí™œìŠµê´€ Â· ìˆ˜ë©´",
      text:
"í•˜ëŠ˜ì´ëŠ” ë°¤ëŠ¦ê²Œê¹Œì§€ ê²Œì„ì„ í•˜ëŠë¼ ìì£¼ ìƒˆë²½ 1~2ì‹œì— ì ì´ ë“­ë‹ˆë‹¤.\nì•„ì¹¨ì—ëŠ” í”¼ê³¤í•´ì„œ ì¼ì–´ë‚˜ê¸° í˜ë“¤ê³ , ìˆ˜ì—… ì‹œê°„ì—ë„ ìê¾¸ ì¡¸ë¦½ë‹ˆë‹¤.\ní•˜ëŠ˜ì´ê°€ ê±´ê°•í•œ ë°œë‹¬ì„ ìœ„í•´ ë…¸ë ¥í•´ì•¼ í•  í–‰ë™ìœ¼ë¡œ ê°€ì¥ ì•Œë§ì€ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?",
      options: [
        "â€œì–´ì°¨í”¼ ì•„ì§ ì–´ë¦¬ë‹ˆê¹Œ, ì§€ê¸ˆì€ ë§ì´ ë†€ê³  ë‚˜ì¤‘ì— ê±´ê°•ì„ ì±™ê¸°ë©´ ë¼.â€ë¼ê³  ìƒê°í•˜ê³  ê·¸ëŒ€ë¡œ ìƒí™œí•œë‹¤.",
        "ì ì´ ë¶€ì¡±í•œ ê²ƒì´ ì„±ì¥ê³¼ ê±´ê°•ì— ì¢‹ì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ì•Œê³ , ê²Œì„ ì‹œê°„ì„ ì¤„ì´ê³ , ë°¤ì—ëŠ” ì¼ì • ì‹œê°„ì— ìë ¤ê³  ë…¸ë ¥í•œë‹¤.",
        "ë‚®ì— ë” ë§ì´ ìì„œ ë°¤ì— ê³„ì† ê²Œì„ì„ í•  ìˆ˜ ìˆë„ë¡, í•™êµì—ì„œ ì¡¸ ë•ŒëŠ” ê·¸ëƒ¥ ì ë²„ë¦°ë‹¤."
      ],
      correct: 1
    },
    {
      tag: "ì„±ì  ë°œë‹¬ Â· ë„ì›€ ìš”ì²­",
      text:
"ì„œì¤€ì´ëŠ” ìµœê·¼ì— ë°¤ì— ê°‘ìê¸° ì†ì˜·ì´ ì –ëŠ” ê²½í—˜(ëª½ì •)ì„ í–ˆìŠµë‹ˆë‹¤.\nì²˜ìŒ ê²ªëŠ” ì¼ì´ë¼ ë†€ë¼ê³  ë¶€ë„ëŸ¬ì›Œì„œ ì•„ë¬´ì—ê²Œë„ ë§í•˜ì§€ ëª»í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nì„œì¤€ì´ê°€ ê°€ì¥ ë°”ë¥´ê²Œ í–‰ë™í•˜ëŠ” ë°©ë²•ì€ ë¬´ì—‡ì¼ê¹Œìš”?",
      options: [
        "â€œì´ìƒí•œ ì¼ì´ ìƒê²¼ë‹¤. í°ì¼ ë‚œ ê²ƒ ê°™ë‹¤.â€ë¼ê³  ìƒê°í•˜ë©°, ì•„ë¬´ì—ê²Œë„ ë§í•˜ì§€ ì•Šê³  í˜¼ì ê±±ì •ë§Œ í•œë‹¤.",
        "ì´ëŸ° ë³€í™”ê°€ ì•„ë™ê¸°ì˜ ìì—°ìŠ¤ëŸ¬ìš´ ë°œë‹¬ ê³¼ì •ì„ì„ ì•Œê³ , ë¯¿ì„ ìˆ˜ ìˆëŠ” ì–´ë¥¸(ë¶€ëª¨ë‹˜ì´ë‚˜ ì„ ìƒë‹˜)ì—ê²Œ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ë¬¼ì–´ë³´ê³ , ì†ì˜·ê³¼ ëª¸ì„ ê¹¨ë—ì´ ê´€ë¦¬í•œë‹¤.",
        "ë„ˆë¬´ ë¶€ë„ëŸ¬ìš°ë‹ˆê¹Œ, ì´ ì¼ì„ ìŠê¸° ìœ„í•´ ê²Œì„ì´ë‚˜ ì˜ìƒë§Œ ê³„ì† ë³¸ë‹¤."
      ],
      correct: 1
    },
    {
      tag: "ì‚¬íšŒì„± Â· ê³µê°",
      text:
"ë°˜ì—ì„œ ëŠ˜ ì¡°ìš©íˆ í˜¼ì ìˆëŠ” ì¹œêµ¬ê°€ ìˆìŠµë‹ˆë‹¤.\nì‰¬ëŠ” ì‹œê°„ì—ë„ í˜¼ì ì±…ë§Œ ë³´ê³ , ì ì‹¬ì‹œê°„ì—ë„ ê±°ì˜ ë§ì„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê·¸ ì¹œêµ¬ë¥¼ ë³¸ ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” í–‰ë™ìœ¼ë¡œ ê°€ì¥ ë°”ëŒì§í•œ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?",
      options: [
        "â€œí˜¼ì ìˆëŠ” ê²Œ í¸í•œê°€ ë³´ë‹¤.â€ë¼ê³  ìƒê°í•˜ë©°, ì „í˜€ ì‹ ê²½ ì“°ì§€ ì•ŠëŠ”ë‹¤.",
        "ì¹œêµ¬ ëª‡ ëª…ê³¼ í•¨ê»˜, ë‹¤ ê°™ì´ ë†€ìê³  ì´ˆëŒ€í•˜ê±°ë‚˜, ê°€ë³ê²Œ ë¨¼ì € ë§ì„ ê±¸ì–´ ë³´ë©° ì²œì²œíˆ ì¹œí•´ì§ˆ ê¸°íšŒë¥¼ ë§Œë“ ë‹¤.",
        "â€œì™œ ë§¨ë‚  í˜¼ìì•¼?â€ë¼ê³  ë†€ë¦¬ë©´ì„œ ì£¼ë³€ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ì›ƒëŠ”ë‹¤."
      ],
      correct: 1
    }
  ];
  let step2Answers = Array(step2Questions.length).fill(null);
  let quizIndex = 0;

  // Step 3 ìŠµê´€
  const habitItems = [
    { id: 1, category: "ìˆ˜ë©´Â·íœ´ì‹ ğŸ˜´", text: "ëŒ€ë¶€ë¶„ì˜ ë‚ ì—, ë°¤ì— ì •í•´ì§„ ì‹œê°„ì— ìë ¤ê³  ë…¸ë ¥í•œë‹¤." },
    { id: 2, category: "ìˆ˜ë©´Â·íœ´ì‹ ğŸ˜´", text: "ì ì„ ì¶©ë¶„íˆ ìê³ , ì•„ì¹¨ì— ì¼ì–´ë‚¬ì„ ë•Œ ë„ˆë¬´ í”¼ê³¤í•˜ì§€ ì•Šë‹¤." },

    { id: 3, category: "ìš´ë™Â·ê±´ê°• ğŸƒâ€â™‚ï¸", text: "ì¼ì£¼ì¼ì— ì—¬ëŸ¬ ë²ˆ, ëª¸ì„ ì›€ì§ì´ëŠ” ìš´ë™ì„ í•˜ê±°ë‚˜ í™œë™ì„ í•œë‹¤." },
    { id: 4, category: "ìš´ë™Â·ê±´ê°• ğŸƒâ€â™‚ï¸", text: "ì•‰ì•„ ìˆì„ ë•Œ ì˜¬ë°”ë¥¸ ìì„¸(í—ˆë¦¬/ì–´ê¹¨/ëª©)ë¥¼ ìœ ì§€í•˜ë ¤ê³  í•œë‹¤." },
    { id: 5, category: "ìš´ë™Â·ê±´ê°• ğŸƒâ€â™‚ï¸", text: "ì‹œë ¥ì´ ë‚˜ë¹ ì§€ì§€ ì•Šë„ë¡ ìŠ¤ë§ˆíŠ¸í°ì´ë‚˜ ì±…ì„ ë„ˆë¬´ ê°€ê¹Œì´ ë³´ì§€ ì•Šìœ¼ë ¤ê³  í•œë‹¤." },

    { id: 6, category: "ìœ„ìƒÂ·ëª¸ ê´€ë¦¬ ğŸ§¼", text: "ëª¸ì„ ê¹¨ë—í•˜ê²Œ ì”»ê³ , ì†ì˜·Â·ì–‘ë§ì„ ë§¤ì¼ ê°ˆì•„ì…ëŠ”ë‹¤." },
    { id: 7, category: "ìœ„ìƒÂ·ëª¸ ê´€ë¦¬ ğŸ§¼", text: "ë•€ì„ ë§ì´ í˜ë ¸ì„ ë•Œ, ì˜·ì„ ê°ˆì•„ì…ê±°ë‚˜ ìƒ¤ì›Œë¥¼ í•œë‹¤." },
    { id: 8, category: "ìœ„ìƒÂ·ëª¸ ê´€ë¦¬ ğŸ§¼", text: "ëª¸ì—ì„œ ë³€í™”ê°€ ìˆì„ ë•Œ(ì—¬ë“œë¦„Â·ì›”ê²½Â·ëª½ì • ë“±) ì²­ê²°ì„ ìœ ì§€í•˜ë ¤ê³  í•œë‹¤." },

    { id: 9, category: "ì •ì„œÂ·ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ğŸ’­", text: "í™”ê°€ ë‚˜ê±°ë‚˜ ì†ìƒí•  ë•Œ, ë‚˜ë¥¼ ì°¨ë¶„í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•œ ë°©ë²•(ì‰¼, ê¹Šì€ ìˆ¨, ì´ì•¼ê¸°í•˜ê¸° ë“±)ì„ ì‚¬ìš©í•˜ë ¤ê³  í•œë‹¤." },
    { id: 10, category: "ì •ì„œÂ·ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ğŸ’­", text: "í˜¼ì í•´ê²°í•˜ê¸° ì–´ë ¤ìš´ ê³ ë¯¼ì´ ìˆì„ ë•Œ, ë¯¿ì„ ìˆ˜ ìˆëŠ” ì–´ë¥¸ì—ê²Œ ë„ì›€ì„ ìš”ì²­í•œë‹¤." },

    { id: 11, category: "ë¯¸ë””ì–´ ì‚¬ìš© ğŸ“±", text: "ìŠ¤ë§ˆíŠ¸í°ì´ë‚˜ ê²Œì„ ì‹œê°„ì„ ìŠ¤ìŠ¤ë¡œ ì¡°ì ˆí•˜ë ¤ê³  ë…¸ë ¥í•œë‹¤." },
    { id: 12, category: "ë¯¸ë””ì–´ ì‚¬ìš© ğŸ“±", text: "ì ë“¤ê¸° ì „ì— ìŠ¤ë§ˆíŠ¸í°Â·íƒœë¸”ë¦¿ì„ ì˜¤ë˜ ë³´ì§€ ì•Šìœ¼ë ¤ê³  í•œë‹¤." },

    { id: 13, category: "ì„±ì  ë°œë‹¬ ê´€ë ¨ ğŸ”", text: "ëª¸ì˜ ë³€í™”(ì›”ê²½Â·ëª½ì •Â·ì„±ì  ë³€í™”)ë¥¼ ë†€ë¦¼ ì—†ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë°›ì•„ë“¤ì´ë ¤ê³  í•œë‹¤." },
    { id: 14, category: "ì„±ì  ë°œë‹¬ ê´€ë ¨ ğŸ”", text: "ìœ í•´í•œ ì˜ìƒÂ·ìŒë€ë¬¼Â·í­ë ¥ì  ì˜ìƒ ë“±ì„ ë³´ì§€ ì•Šìœ¼ë ¤ê³  ì¡°ì‹¬í•œë‹¤." }
  ];
  // 0 = ë¯¸ì„ íƒ, 1 = ì•„ë‹ˆë‹¤, 2 = ë³´í†µ, 3 = í•­ìƒ  (ì ìˆ˜ëŠ” 0,1,2)
  let habitAnswers = {};

  // Step 1 ì²´í¬ê°’
  let step1Checked = new Set();

  // ====== UI ë Œë”ë§ ======

  function updateStepper() {
    const progress = document.getElementById("stepProgress");
    const pct = (currentStep - 1) / (stepCount - 1) * 100;
    progress.style.width = pct + "%";

    document.querySelectorAll("[data-step-badge]").forEach(el => {
      const step = parseInt(el.getAttribute("data-step-badge"), 10);
      if (step === currentStep) el.classList.add("active");
      else el.classList.remove("active");
    });

    const hint = document.getElementById("stepHint");
    if (currentStep === 1) hint.textContent = "1ë‹¨ê³„: ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í†µí•´ ë‚˜ì˜ ë³€í™”ë¥¼ ì‚´í´ë³´ëŠ” ì¤‘ì…ë‹ˆë‹¤.";
    else if (currentStep === 2) hint.textContent = "2ë‹¨ê³„: ìƒí™©ë³„ë¡œ ì–´ë–¤ ì„ íƒì´ ë„ì›€ì´ ë˜ëŠ”ì§€ ìƒê°í•˜ë©° í€´ì¦ˆë¥¼ í’€ì–´ë³´ëŠ” ì¤‘ì…ë‹ˆë‹¤.";
    else if (currentStep === 3) hint.textContent = "3ë‹¨ê³„: ìˆ˜ë©´Â·ìš´ë™Â·ìœ„ìƒÂ·ë¯¸ë””ì–´ ì‚¬ìš© ë“± ìƒí™œìŠµê´€ì„ ì ê²€í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤.";
    else hint.textContent = "4ë‹¨ê³„: ì§€ê¸ˆê¹Œì§€ì˜ ë‹µì„ ë°”íƒ•ìœ¼ë¡œ ë‚˜ì˜ ë°œë‹¬ ì¹´ë“œë¥¼ í™•ì¸í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤.";

    document.getElementById("btnPrev").disabled = currentStep === 1;
    const nextBtn = document.getElementById("btnNext");
    if (currentStep === 4) {
      nextBtn.textContent = "ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸° ğŸ”";
    } else {
      nextBtn.textContent = "ë‹¤ìŒ ë‹¨ê³„ë¡œ â–¶";
      nextBtn.disabled = false;
    }

    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(`screen-step${currentStep}`).classList.add("active");
  }

  // Step1 ë Œë”
  function renderStep1() {
    const grid = document.getElementById("domainGrid");
    grid.innerHTML = "";
    const grouped = {
      physical: [],
      cognitive: [],
      emotional: [],
      social: []
    };
    step1Questions.forEach(q => grouped[q.domain].push(q));

    Object.keys(grouped).forEach(domainKey => {
      const meta = domainsMeta[domainKey];
      const card = document.createElement("div");
      card.className = "domain-card";

      const header = document.createElement("div");
      header.className = "domain-header";
      const title = document.createElement("div");
      title.className = "domain-title";
      const colorDot = document.createElement("span");
      colorDot.textContent = meta.emoji;
      title.appendChild(colorDot);
      const spanText = document.createElement("span");
      spanText.textContent = meta.label;
      title.appendChild(spanText);

      const chip = document.createElement("div");
      chip.className = "domain-chip";
      const checkedCount = [...step1Checked].filter(id => {
        const q = step1Questions.find(q => q.id === id);
        return q && q.domain === domainKey;
      }).length;
      chip.textContent = `ì²´í¬ ${checkedCount}/4`;

      header.appendChild(title);
      header.appendChild(chip);

      const qWrap = document.createElement("div");
      qWrap.className = "domain-questions";

      grouped[domainKey].forEach(q => {
        const row = document.createElement("label");
        row.className = "question-row";
        const input = document.createElement("input");
        input.type = "checkbox";
        input.checked = step1Checked.has(q.id);
        input.addEventListener("change", () => {
          if (input.checked) step1Checked.add(q.id);
          else step1Checked.delete(q.id);
          renderStep1(); // ë‹¤ì‹œ ë Œë”í•´ì„œ chip ìˆ«ì ì—…ë°ì´íŠ¸
        });
        const txt = document.createElement("div");
        txt.textContent = q.text;
        row.appendChild(input);
        row.appendChild(txt);
        qWrap.appendChild(row);
      });

      card.appendChild(header);
      card.appendChild(qWrap);
      grid.appendChild(card);
    });
  }

  // Step2 ë Œë”
  function renderQuiz() {
    const q = step2Questions[quizIndex];
    const card = document.getElementById("quizCard");
    card.innerHTML = "";

    const top = document.createElement("div");
    top.className = "quiz-top";
    const left = document.createElement("div");
    left.textContent = `ë¬¸ì œ ${quizIndex + 1} / ${step2Questions.length}`;
    const tag = document.createElement("div");
    tag.className = "quiz-tag";
    tag.textContent = q.tag;
    top.appendChild(left);
    top.appendChild(tag);

    const qText = document.createElement("div");
    qText.className = "quiz-question";
    qText.textContent = q.text;

    const optsWrap = document.createElement("div");
    optsWrap.className = "quiz-options";

    q.options.forEach((opt, idx) => {
      const optDiv = document.createElement("div");
      optDiv.className = "option-card";
      if (step2Answers[quizIndex] === idx) optDiv.classList.add("selected");
      optDiv.addEventListener("click", () => {
        step2Answers[quizIndex] = idx;
        renderQuiz();
      });

      const labelSpan = document.createElement("span");
      labelSpan.className = "label";
      labelSpan.textContent = ["A", "B", "C"][idx];

      const textSpan = document.createElement("span");
      textSpan.textContent = opt;

      optDiv.appendChild(labelSpan);
      optDiv.appendChild(textSpan);
      optsWrap.appendChild(optDiv);
    });

    card.appendChild(top);
    card.appendChild(qText);
    card.appendChild(optsWrap);

    const dots = document.getElementById("quizDots");
    let dotStr = "";
    for (let i = 0; i < step2Questions.length; i++) {
      const done = step2Answers[i] !== null;
      if (i === quizIndex) {
        dotStr += done ? "â—" : "â—‰";
      } else {
        dotStr += done ? "â—" : "â—‹";
      }
      dotStr += " ";
    }
    dots.textContent = dotStr.trim();
  }

  // Step3 ë Œë”
  function renderHabits() {
    const grid = document.getElementById("habitGrid");
    grid.innerHTML = "";
    const grouped = {};
    habitItems.forEach(h => {
      if (!grouped[h.category]) grouped[h.category] = [];
      grouped[h.category].push(h);
    });

    Object.keys(grouped).forEach(cat => {
      const box = document.createElement("div");
      box.className = "habit-category";
      const title = document.createElement("div");
      title.className = "habit-cat-title";
      title.textContent = cat;
      box.appendChild(title);

      grouped[cat].forEach(item => {
        const itemDiv = document.createElement("div");
        itemDiv.className = "habit-item";
        const tDiv = document.createElement("div");
        tDiv.className = "habit-text";
        tDiv.textContent = item.text;
        const scale = document.createElement("div");
        scale.className = "habit-scale";
        const labels = [
          { key: 3, text: "í•­ìƒ" },
          { key: 2, text: "ë³´í†µ" },
          { key: 1, text: "ê±°ì˜ ì•„ë‹ˆë‹¤" }
        ];
        labels.forEach(lb => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "habit-btn";
          const current = habitAnswers[item.id] || 0;
          if (current === lb.key) btn.classList.add("selected");
          btn.textContent = lb.text;
          btn.addEventListener("click", () => {
            habitAnswers[item.id] = lb.key;
            renderHabits();
            updateHabitPreview();
          });
          scale.appendChild(btn);
        });

        itemDiv.appendChild(tDiv);
        itemDiv.appendChild(scale);
        box.appendChild(itemDiv);
      });

      grid.appendChild(box);
    });

    updateHabitPreview();
  }

  function updateHabitPreview() {
    let score = 0;
    let answered = 0;
    habitItems.forEach(h => {
      const v = habitAnswers[h.id] || 0;
      if (v > 0) answered++;
      if (v === 2) score += 1;
      else if (v === 3) score += 2;
    });
    document.getElementById("habitScorePreview").textContent = score;
    const levelText = document.getElementById("habitLevelText");
    if (!answered) {
      levelText.textContent = "ì•„ì§ ì„ íƒí•œ ë¬¸í•­ì´ ê±°ì˜ ì—†ì–´ìš”.";
    } else if (score >= 23) {
      levelText.textContent = "ìƒí™œìŠµê´€ì´ ì „ë°˜ì ìœ¼ë¡œ ë§¤ìš° ê±´ê°•í•œ í¸ì´ì—ìš”!";
    } else if (score >= 15) {
      levelText.textContent = "ìƒí™œìŠµê´€ì´ ë³´í†µ ì´ìƒì´ì—ìš”. í•œë‘ ê°€ì§€ë¥¼ ë³´ì™„í•˜ë©´ ë” ì¢‹ì•„ì§ˆ ìˆ˜ ìˆì–´ìš”.";
    } else {
      levelText.textContent = "ìƒí™œìŠµê´€ì„ ì¡°ê¸ˆ ë” ì •ë¦¬í•´ ë³´ë©´ ì¢‹ê² ì–´ìš”.";
    }
  }

  // ====== í‰ê°€ ë¡œì§ ======

  function getStep1DomainScores() {
    const scores = { physical: 0, cognitive: 0, emotional: 0, social: 0 };
    step1Checked.forEach(id => {
      const q = step1Questions.find(q => q.id === id);
      if (q) scores[q.domain]++;
    });
    return scores;
  }

  function getDomainText(domainKey, score) {
    const label = domainsMeta[domainKey].label;
    if (domainKey === "physical") {
      if (score <= 1) {
        return `â— ${label}\nì•„ì§ì€ ëª¸ì˜ ë³€í™”ë¥¼ í¬ê²Œ ëŠë¼ì§€ ëª»í•  ìˆ˜ë„ ìˆì–´ìš”.\nì•ìœ¼ë¡œ í‚¤ì™€ ì²´ë ¥ ë³€í™”ì— ì¡°ê¸ˆ ë” ê´€ì‹¬ì„ ê°€ì ¸ ë³´ë©´ ì¢‹ì•„ìš”.`;
      } else if (score <= 3) {
        return `â— ${label}\nëª¸ì´ ìë¼ê³  ìˆë‹¤ëŠ” ê²ƒì„ ì˜ ëŠë¼ê³  ìˆì–´ìš”.\nìš´ë™Â·ìˆ˜ë©´Â·ì‹ìŠµê´€ì„ ì˜ ìœ ì§€í•˜ë©´ ë”ìš± ê±´ê°•í•˜ê²Œ ì„±ì¥í•  ìˆ˜ ìˆì–´ìš”.`;
      } else {
        return `â— ${label}\nì‹ ì²´ê°€ ìë¼ëŠ” ëª¨ìŠµì„ ìì‹  ìˆê²Œ ì´í•´í•˜ê³  ìˆë„¤ìš”!\nì§€ê¸ˆì²˜ëŸ¼ ê±´ê°•ì„ ì†Œì¤‘íˆ ì—¬ê¸°ë©´ í›Œë¥­í•˜ê²Œ ì„±ì¥í•  ìˆ˜ ìˆì–´ìš”.`;
      }
    } else if (domainKey === "cognitive") {
      if (score <= 1) {
        return `â— ${label}\nìƒê°ì´ë‚˜ í•™ìŠµì—ì„œì˜ ë³€í™”ë¥¼ ì•„ì§ ë§ì´ ëŠë¼ì§€ ëª»í•  ìˆ˜ë„ ìˆì–´ìš”.\nì²œì²œíˆ ê³„íš ì„¸ìš°ê¸°ì™€ ë‹¤ì–‘í•œ í•´ê²° ë°©ë²•ì„ ì—°ìŠµí•´ ë³´ë©´ ì¢‹ì•„ìš”.`;
      } else if (score <= 3) {
        return `â— ${label}\në¬¸ì œë¥¼ ì—¬ëŸ¬ ë°©ì‹ìœ¼ë¡œ í•´ê²°í•˜ê³ , ë³µì¡í•œ ë‚´ìš©ì„ ì´í•´í•˜ëŠ” ëŠ¥ë ¥ì´ ìë¼ê³  ìˆì–´ìš”.`;
      } else {
        return `â— ${label}\në…¼ë¦¬ì ìœ¼ë¡œ ìƒê°í•˜ê³  ê³„íšì„ ì„¸ìš°ëŠ” ëŠ¥ë ¥ì´ í›Œë¥­í•˜ê²Œ ë°œë‹¬í•˜ê³  ìˆì–´ìš”!`;
      }
    } else if (domainKey === "emotional") {
      if (score <= 1) {
        return `â— ${label}\nì—¬ëŸ¬ ê°ì •ì„ ìŠ¤ìŠ¤ë¡œ ì´í•´í•˜ê³  í‘œí˜„í•˜ëŠ” ì—°ìŠµì´ ì¡°ê¸ˆ ë” í•„ìš”í•´ìš”.\nê°ì •ì„ ì¸ì •í•˜ê³  ë§ë¡œ í‘œí˜„í•˜ëŠ” ì—°ìŠµì„ í•´ ë³´ë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤.`;
      } else if (score <= 3) {
        return `â— ${label}\nê°ì •ì„ ë‹¤ì–‘í•˜ê²Œ ëŠë¼ê³ , ì°¨ë¶„í•˜ê²Œ ì¡°ì ˆí•˜ë ¤ëŠ” ë…¸ë ¥ì´ ë³´ì…ë‹ˆë‹¤.`;
      } else {
        return `â— ${label}\nê°ì •ì„ ì˜ ì¸ì‹í•˜ê³ , ë§ì„ í†µí•´ í‘œí˜„í•˜ë ¤ëŠ” í›Œë¥­í•œ ì •ì„œ ì¡°ì ˆ ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆì–´ìš”.`;
      }
    } else if (domainKey === "social") {
      if (score <= 1) {
        return `â— ${label}\nì¹œêµ¬ì™€ì˜ ê´€ê³„ì—ì„œ ë” ë”°ëœ»í•˜ê³  ì ê·¹ì ì¸ ì†Œí†µì„ ì—°ìŠµí•´ ë³´ë©´ ì¢‹ì•„ìš”.`;
      } else if (score <= 3) {
        return `â— ${label}\në‹¤ë¥¸ ì‚¬ëŒì˜ ê¸°ë¶„ì„ ìƒê°í•˜ê³  ëŒ€í™”ë¥¼ í†µí•´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ëŠ” ëª¨ìŠµì´ ë³´ì—¬ìš”.`;
      } else {
        return `â— ${label}\nì¹œêµ¬ì™€ í˜‘ë ¥í•˜ê³ , ë°°ë ¤í•˜ë©° ê´€ê³„ë¥¼ ì˜ ìœ ì§€í•˜ëŠ” ë©‹ì§„ ì‚¬íšŒì„±ì„ ê°€ì§€ê³  ìˆì–´ìš”!`;
      }
    }
    return "";
  }

  function getUnderstandingScore() {
    let s = 0;
    step2Questions.forEach((q, idx) => {
      if (step2Answers[idx] === q.correct) s++;
    });
    return s;
  }

  function getUnderstandingText(score) {
    if (score >= 5) {
      return `â— ë°œë‹¬ ì´í•´ ì ìˆ˜: ë§¤ìš° ì¢‹ìŒ (${score} / 6ì )\nì•„ë™ê¸°ì˜ ë°œë‹¬ì„ ì˜ ì´í•´í•˜ê³ , ì¹œêµ¬ì™€ ìì‹ ì„ ì¡´ì¤‘í•˜ëŠ” íƒœë„ê°€ ì•„ì£¼ ì¢‹ì•„ìš”.`;
    } else if (score >= 3) {
      return `â— ë°œë‹¬ ì´í•´ ì ìˆ˜: ë³´í†µ (${score} / 6ì )\në°œë‹¬ì— ëŒ€í•œ ì´í•´ëŠ” ì¢‹ì€ í¸ì´ì§€ë§Œ, ëª‡ ê°€ì§€ ìƒí™©ì—ì„œëŠ” ì¡°ê¸ˆ ë” ìƒê°í•´ ë³´ë©´ ë” ë‚˜ì€ ì„ íƒì„ í•  ìˆ˜ ìˆì–´ìš”.`;
    } else {
      return `â— ë°œë‹¬ ì´í•´ ì ìˆ˜: ë³´ì™„ í•„ìš” (${score} / 6ì )\nì•„ë™ê¸°ì˜ ë°œë‹¬ê³¼ ê´€ë ¨ëœ ìƒí™©ì„ ë‹¤ì‹œ í•œ ë²ˆ ì •ë¦¬í•´ ë³¼ í•„ìš”ê°€ ìˆì–´ìš”.\nêµê³¼ì„œ ë‚´ìš©ì„ ë‹¤ì‹œ ì½ê³ , ì„ ìƒë‹˜ê³¼ í•¨ê»˜ ì–´ë–¤ ì„ íƒì´ ë” ë„ì›€ì´ ë˜ëŠ”ì§€ ì´ì•¼ê¸°í•´ ë³´ë©´ ì¢‹ì•„ìš”.`;
    }
  }

  function getHabitScore() {
    let score = 0;
    habitItems.forEach(h => {
      const v = habitAnswers[h.id] || 0;
      if (v === 2) score += 1;
      else if (v === 3) score += 2;
    });
    return score;
  }

  function getHabitText(score) {
    if (score >= 23) {
      return `â— ìƒí™œìŠµê´€ ì ìˆ˜: ë§¤ìš° ê±´ê°• (${score} / 28ì )\nìˆ˜ë©´Â·ìš´ë™Â·ìœ„ìƒÂ·ë¯¸ë””ì–´ ì‚¬ìš© ë“± ìƒí™œìŠµê´€ì´ ì•„ì£¼ ê±´ê°•í•œ í¸ì´ì—ìš”.\nì´ëŸ° ì¢‹ì€ ìŠµê´€ì€ ë°œë‹¬ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤.`;
    } else if (score >= 15) {
      return `â— ìƒí™œìŠµê´€ ì ìˆ˜: ë³´í†µ (${score} / 28ì )\nëŒ€ë¶€ë¶„ì˜ ìƒí™œìŠµê´€ì€ ê´œì°®ì§€ë§Œ, ëª‡ ê°€ì§€ë¥¼ ì¡°ê¸ˆ ë” ì‹ ê²½ ì“°ë©´ ë” ê±´ê°•í•˜ê²Œ ìë„ ìˆ˜ ìˆì–´ìš”.\níŠ¹íˆ ìˆ˜ë©´Â·ë¯¸ë””ì–´ ì‚¬ìš©Â·ê°ì • ê´€ë¦¬ ì¤‘ì—ì„œ í•˜ë‚˜ë¥¼ ê³¨ë¼ ë¨¼ì € ì‹¤ì²œí•´ ë³´ë©´ ì¢‹ìŠµë‹ˆë‹¤.`;
    } else {
      return `â— ìƒí™œìŠµê´€ ì ìˆ˜: ë³´ì™„ í•„ìš” (${score} / 28ì )\nìƒí™œìŠµê´€ì„ í•œ ë²ˆ ì •ë¦¬í•´ ë³¼ í•„ìš”ê°€ ìˆì–´ìš”.\nê·œì¹™ì ì¸ ìˆ˜ë©´, ì ë‹¹í•œ ìš´ë™, ìœ„ìƒ ê´€ë¦¬, ìŠ¤ë§ˆíŠ¸í° ì‚¬ìš© ì¡°ì ˆ ë“±ì„ ì°¨ê·¼ì°¨ê·¼ ë°”ê¿” ë³´ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.`;
    }
  }

  function buildStrengthsAndImprovements(domainScores, understandingScore, habitScore) {
    const strengths = [];
    const improvements = [];

    // ê°•ì  í›„ë³´
    if (domainScores.physical >= 3) strengths.push("ëª¸ì´ ìë¼ê³  ìˆë‹¤ëŠ” ê²ƒì„ ì˜ ëŠë¼ê³ , ê±´ê°•ì„ ì†Œì¤‘íˆ ì—¬ê¸°ë ¤ëŠ” íƒœë„ê°€ ì¢‹ì•„ìš”.");
    if (domainScores.cognitive >= 3) strengths.push("ë¬¸ì œë¥¼ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ í•´ê²°í•˜ê³ , ìŠ¤ìŠ¤ë¡œ ìƒê°í•˜ëŠ” í˜ì´ ì˜ ìë¼ê³  ìˆì–´ìš”.");
    if (domainScores.emotional >= 3) strengths.push("ê°ì •ì„ ì˜ ì•Œì•„ì°¨ë¦¬ê³ , ì°¨ë¶„í•˜ê²Œ í‘œí˜„í•˜ë ¤ëŠ” ë…¸ë ¥ì´ ë‹ë³´ì…ë‹ˆë‹¤.");
    if (domainScores.social >= 3) strengths.push("ì¹œêµ¬ì˜ ê¸°ë¶„ì„ ìƒê°í•˜ê³ , ëŒ€í™”ë¥¼ í†µí•´ ê´€ê³„ë¥¼ ì§€í‚¤ë ¤ëŠ” ëª¨ìŠµì´ ë©‹ì ¸ìš”.");
    if (understandingScore >= 5) strengths.push("ì•„ë™ê¸°ì˜ ë°œë‹¬ì„ ì˜ ì´í•´í•˜ê³ , ë‚˜ì™€ ì¹œêµ¬ë¥¼ ì¡´ì¤‘í•˜ëŠ” íƒœë„ê°€ ì˜ ìë¦¬ ì¡í˜€ ìˆì–´ìš”.");
    if (habitScore >= 23) strengths.push("ìƒí™œìŠµê´€ì´ ì „ë°˜ì ìœ¼ë¡œ ê±´ê°•í•´ì„œ, ì•ìœ¼ë¡œì˜ ì„±ì¥ì—ë„ í° ë„ì›€ì´ ë  ê±°ì˜ˆìš”.");

    // ë³´ì™„ í›„ë³´
    if (domainScores.physical <= 1) improvements.push("ëª¸ì˜ ë³€í™”ë¥¼ ê¸ì •ì ìœ¼ë¡œ ë°”ë¼ë³´ê³ , ìš´ë™Â·ìˆ˜ë©´Â·ì‹ìŠµê´€ì„ ì¡°ê¸ˆ ë” ì±™ê²¨ ë³´ë©´ ì¢‹ê² ì–´ìš”.");
    if (domainScores.cognitive <= 1) improvements.push("ê³„íšì„ ì„¸ìš°ê³  ìˆœì„œë¥¼ ì •í•´ ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ì—°ìŠµì„ ì¡°ê¸ˆ ë” í•´ ë³´ë©´ ì¢‹ì•„ìš”.");
    if (domainScores.emotional <= 1) improvements.push("ê°ì •ì„ ì°¸ê¸°ë³´ë‹¤, ì•ˆì „í•˜ê²Œ í‘œí˜„í•˜ëŠ” ë°©ë²•(ë§í•˜ê¸°, ê¸€ì“°ê¸°, ë„ì›€ ìš”ì²­í•˜ê¸°)ì„ ì—°ìŠµí•´ ë³´ë©´ ì¢‹ê² ì–´ìš”.");
    if (domainScores.social <= 1) improvements.push("ì¹œêµ¬ì—ê²Œ ë¨¼ì € ë§ì„ ê±¸ì–´ ë³´ê±°ë‚˜, ê°ˆë“±ì„ ëŒ€í™”ë¡œ í’€ì–´ë³´ëŠ” ì—°ìŠµì„ í•´ ë³´ë©´ ì¢‹ì•„ìš”.");
    if (understandingScore <= 2) improvements.push("ë°œë‹¬ê³¼ ê´€ë ¨ëœ ìƒí™©ì„ ë‹¤ì‹œ í•œ ë²ˆ ì •ë¦¬í•´ ë³´ê³ , ì¹œêµ¬ë¥¼ ë†€ë¦¬ì§€ ì•ŠëŠ” íƒœë„ë¥¼ ë” ê°•í™”í•˜ë©´ ì¢‹ê² ì–´ìš”.");
    if (habitScore <= 22) improvements.push("ìˆ˜ë©´Â·ìš´ë™Â·ë¯¸ë””ì–´ ì‚¬ìš© ì¤‘ í•œ ê°€ì§€ë¥¼ ê³¨ë¼, ì¼ì£¼ì¼ ë™ì•ˆë§Œì´ë¼ë„ ì¡°ê¸ˆì”© ë°”ê¿” ë³´ëŠ” ì—°ìŠµì„ í•´ ë³´ë©´ ì¢‹ìŠµë‹ˆë‹¤.");

    const finalStrengths = strengths.slice(0, 3);
    while (finalStrengths.length < 3) {
      const fillers = [
        "ë‚˜ì˜ ë³€í™”ë¥¼ ëŒì•„ë³´ê³  ìƒê°í•´ ë³´ëŠ” ê²ƒ ìì²´ê°€ ì´ë¯¸ í›Œë¥­í•œ ì‹œì‘ì´ì—ìš”.",
        "ìŠ¤ìŠ¤ë¡œë¥¼ ëŒì•„ë³´ëŠ” ì—°ìŠµì„ í•˜ê³  ìˆë‹¤ëŠ” ì ì´ ê°€ì¥ í° ê°•ì ì´ì—ìš”.",
        "ì•ìœ¼ë¡œì˜ ë³€í™”ë¥¼ ìŠ¤ìŠ¤ë¡œ ê¸°ë¡í•´ ë³´ëŠ” ê²ƒë„ ì¢‹ì€ ìŠµê´€ì´ ë  ê±°ì˜ˆìš”."
      ];
      finalStrengths.push(fillers[finalStrengths.length % fillers.length]);
    }

    const finalImprovements = improvements.slice(0, 2);
    while (finalImprovements.length < 2) {
      const fillers = [
        "ìƒí™œìŠµê´€ ì¤‘ì—ì„œ í•˜ë‚˜ë¥¼ ê³¨ë¼, ì‘ì€ ëª©í‘œë¥¼ ì„¸ìš°ê³  ì‹¤ì²œí•´ ë³´ë©´ ì¢‹ì•„ìš”.",
        "ì§€ê¸ˆì˜ ë‚˜ë¥¼ ìˆëŠ” ê·¸ëŒ€ë¡œ ì¸ì •í•˜ë©´ì„œ, ì¡°ê¸ˆì”© ë‚˜ì•„ì§€ê³  ì‹¶ì€ ë¶€ë¶„ì„ ì •í•´ ë³´ë©´ ì¢‹ìŠµë‹ˆë‹¤."
      ];
      finalImprovements.push(fillers[finalImprovements.length - 0]);
      if (finalImprovements.length >= 2) break;
    }

    return { strengths: finalStrengths, improvements: finalImprovements };
  }

  function buildImagePrompt(domainScores, understandingScore, habitScore) {
    // ë¶„ìœ„ê¸°ë§Œ ì•½ê°„ ë‹¤ë¥´ê²Œ
    let mood = "ë°ê³  ê±´ê°•í•œ";
    if (habitScore < 15 || understandingScore <= 2) {
      mood = "ì¡°ê¸ˆ ìƒê°ì— ì ê¸´ í‘œì •ì´ì§€ë§Œ, ì„±ì¥ ê°€ëŠ¥ì„±ì´ ëŠê»´ì§€ëŠ”";
    } else if (domainScores.emotional >= 3 && domainScores.social >= 3) {
      mood = "ë¯¸ì†Œë¥¼ ì§“ê³  ì¹œêµ¬ë“¤ì—ê²Œ ì¹œê·¼í•œ ëŠë‚Œì˜";
    }

    const base =
`${mood} ì´ˆë“±í•™êµ 5í•™ë…„ í•™ìƒì´ ì„œ ìˆëŠ” ì „ì‹  ì¼ëŸ¬ìŠ¤íŠ¸.
ë°°ê²½ì€ ë¶€ë“œëŸ¬ìš´ íŒŒìŠ¤í…” í†¤ êµì‹¤ì´ë‚˜ í•™êµ ë³µë„.
ì‹ ì²´, ìƒê°, ê°ì •, ì‚¬íšŒì„±ì´ í•¨ê»˜ ìë¼ëŠ” ëŠë‚Œì˜ ë”°ëœ»í•œ ë¶„ìœ„ê¸°.
í•œêµ­ ì´ˆë“±í•™êµ êµê³¼ì„œ ì‚½í™” ìŠ¤íƒ€ì¼, ë„ˆë¬´ ë³µì¡í•˜ì§€ ì•Šì€ ê·¸ë¦¼.`;

    return base;
  }

  function renderResultCard() {
    const domainScores = getStep1DomainScores();
    const understandingScore = getUnderstandingScore();
    const habitScore = getHabitScore();

    // Domain bars
    const bars = document.getElementById("domainBars");
    bars.innerHTML = "";
    Object.keys(domainScores).forEach(key => {
      const meta = domainsMeta[key];
      const score = domainScores[key];
      const row = document.createElement("div");
      row.className = "domain-bar-row";

      const label = document.createElement("span");
      label.textContent = `${meta.emoji} ${meta.label}`;

      const dots = document.createElement("span");
      dots.className = "dot-row";
      let dotStr = "";
      for (let i = 0; i < 4; i++) {
        dotStr += i < score ? "â—" : "â—‹";
      }
      dots.textContent = dotStr;

      row.appendChild(label);
      row.appendChild(dots);
      bars.appendChild(row);
    });

    // Domain analysis
    const domainTextParts = [];
    Object.keys(domainScores).forEach(key => {
      domainTextParts.push(getDomainText(key, domainScores[key]));
    });
    document.getElementById("domainAnalysis").textContent = domainTextParts.join("\n\n");

    // Understanding analysis
    document.getElementById("understandingAnalysis").textContent = getUnderstandingText(understandingScore);

    // Habit analysis
    document.getElementById("habitAnalysis").textContent = getHabitText(habitScore);

    // Strengths & improvements
    const { strengths, improvements } = buildStrengthsAndImprovements(domainScores, understandingScore, habitScore);
    document.getElementById("strengthList").textContent = strengths.map(s => "Â· " + s).join("\n");
    document.getElementById("improveList").textContent = improvements.map(s => "Â· " + s).join("\n");

    // Image prompt
    const prompt = buildImagePrompt(domainScores, understandingScore, habitScore);
    document.getElementById("imagePrompt").value = prompt;
    document.getElementById("copyStatus").textContent = "";
  }

  // ====== ë„¤ë¹„ê²Œì´ì…˜ ======

  function goToNextStep() {
    if (currentStep === 1) {
      // ìµœì†Œ í•œ ê°œ ì´ìƒì€ ì²´í¬í•˜ë„ë¡ ê²½ê³  ì •ë„
      if (step1Checked.size === 0 && !confirm("ì•„ì§ ì²´í¬í•œ ë¬¸í•­ì´ ì—†ì–´ìš”. ê·¸ë˜ë„ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°ˆê¹Œìš”?")) {
        return;
      }
      currentStep = 2;
    } else if (currentStep === 2) {
      if (step2Answers.some(a => a === null)) {
        if (!confirm("í’€ì§€ ì•Šì€ ë¬¸ì œê°€ ìˆì–´ìš”. ê·¸ë˜ë„ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°ˆê¹Œìš”?")) return;
      }
      currentStep = 3;
    } else if (currentStep === 3) {
      currentStep = 4;
      renderResultCard();
    } else {
      // ë‹¤ì‹œ ì²˜ìŒìœ¼ë¡œ
      currentStep = 1;
    }
    updateStepper();
  }

  function goToPrevStep() {
    if (currentStep > 1) {
      currentStep--;
      updateStepper();
    }
  }

  // ====== ì´ˆê¸°í™” ======

  document.addEventListener("DOMContentLoaded", () => {
    renderStep1();
    renderQuiz();
    renderHabits();
    updateStepper();

    document.getElementById("btnNext").addEventListener("click", () => {
      if (currentStep === 2) {
        // quiz ë‚´ì—ì„œ ì´ì „/ë‹¤ìŒ ë¬¸ì œëŠ” í™”ì‚´í‘œë¡œ ì´ë™í•  ìˆ˜ ì—†ìœ¼ë‹ˆ, ì—¬ê¸°ì„  ë‹¨ê³„ ì´ë™ë§Œ
      }
      goToNextStep();
    });
    document.getElementById("btnPrev").addEventListener("click", goToPrevStep);

    // í€´ì¦ˆ ì¹´ë“œ ë‚´ ì¢Œìš° ì´ë™ì„ ìœ„í•´ í‚¤ë³´ë“œ í™”ì‚´í‘œ ì‚¬ìš©ì€ ìƒëµ, ì—¬ê¸°ì„œëŠ” ë”ë¸”í´ë¦­ ëŒ€ì‹ 
    // ìƒë‹¨/í•˜ë‹¨ ë²„íŠ¼ ëŒ€ì‹ , ì—¬ê¸°ëŠ” ì¢Œìš° í™”ì‚´í‘œ ì—†ëŠ” ëŒ€ì‹ , ì•„ë˜ì™€ ê°™ì´ ë§ˆìš°ìŠ¤ ì—†ì´ë„ í•´ê²° ê°€ëŠ¥
    // (í•„ìš”í•˜ë©´ ì¶”ê°€ë¡œ êµ¬í˜„ ê°€ëŠ¥)
    // í€´ì¦ˆ ì¹´ë“œ í´ë¦­ ì˜ì—­ í™•ì¥: ì—†ìŒ

    // í€´ì¦ˆ ì¹´ë“œì— ì¢Œìš° ì´ë™ì€ ë‹¤ìŒ/ì´ì „ ì§ˆë¬¸ ìœ„í•´ ë‹¨ì¶•í‚¤ë¡œ ì¶”ê°€ ë²„íŠ¼ ì—†ì´ êµ¬í˜„
    // ì—¬ê¸°ì„œëŠ” step2 í™”ë©´ì¼ ë•Œë§Œ, ë²„íŠ¼ ëŒ€ì‹  í™”ë©´ í•˜ë‹¨ ì´ë™:
    const quizDots = document.getElementById("quizDots");
    quizDots.addEventListener("click", () => {
      // í´ë¦­ ì‹œ ì•„ë¬´ ë™ì‘ ì•ˆ í•¨. í•„ìš”í•˜ë©´ ë‚˜ì¤‘ì— ì  í´ë¦­ ì´ë™ë„ êµ¬í˜„ ê°€ëŠ¥.
    });

    // ì¢Œìš° ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ëŒ€ì‹  í‚¤ë³´ë“œ ë°©í–¥í‚¤ ì§€ì› (ì„ íƒì‚¬í•­)
    document.addEventListener("keydown", (e) => {
      if (currentStep === 2) {
        if (e.key === "ArrowRight") {
          if (quizIndex < step2Questions.length - 1) {
            quizIndex++;
            renderQuiz();
          }
        } else if (e.key === "ArrowLeft") {
          if (quizIndex > 0) {
            quizIndex--;
            renderQuiz();
          }
        }
      }
    });

    // ê²°ê³¼ í™”ë©´ ì´ë¦„ ì…ë ¥í•´ë„ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§„ ì•Šì§€ë§Œ, í”„ë¡¬í”„íŠ¸ì— ë°˜ì˜í•  ìˆ˜ë„ ìˆìŒ

    document.getElementById("btnCopyPrompt").addEventListener("click", async () => {
      const text = document.getElementById("imagePrompt").value;
      const status = document.getElementById("copyStatus");
      try {
        await navigator.clipboard.writeText(text);
        status.textContent = "í”„ë¡¬í”„íŠ¸ë¥¼ ë³µì‚¬í–ˆì–´ìš”. ChatGPT ì´ë¯¸ì§€ ë§Œë“¤ê¸°ì— ë¶™ì—¬ë„£ì–´ ë³´ì„¸ìš”.";
      } catch (e) {
        status.textContent = "ë³µì‚¬ê°€ ì˜ ì•ˆ ë˜ë©´, ìœ„ í…ìŠ¤íŠ¸ë¥¼ ë“œë˜ê·¸í•´ì„œ ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”.";
      }
    });

    // í€´ì¦ˆ ë‹¤ìŒ/ì´ì „ ë¬¸ì œë¥¼ ë„¤ë¹„ê²Œì´ì…˜: í™”ë©´ ìƒë‹¨ stepì€ ê·¸ëŒ€ë¡œ ìœ ì§€
    // â†’ ì‚¬ìš© í¸ì˜ë¥¼ ìœ„í•´, ì¹´ë“œ ìœ„ì•„ë˜ì— í‚¤ ì¡°ì‘ ì™¸ ë²„íŠ¼ ì—†ì´ ë‹¨ìˆœíˆ í˜„ì¬ ë¬¸ì œë§Œ
    // (ì›í•˜ë©´ ë‚˜ì¤‘ì— 'ì´ì „ ë¬¸ì œ/ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ ì¶”ê°€ ê°€ëŠ¥)
    // ì¼ë‹¨ ê°„ë‹¨í•˜ê²Œ: ì¹´ë“œ í´ë¦­ìœ¼ë¡œëŠ” ì´ë™ ì•ˆ í•˜ê³ , ì•„ë˜ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
    // ì—¬ê¸°ì„œ ì¶”ê°€ ë„¤ë¹„ ë²„íŠ¼ì„ footerì— ë¼ìš°ê¸° ì• ë§¤í•˜ë‹ˆ, í•„ìš”í•˜ë©´ ë‹¤ì‹œ ë§í•´ì¤˜!
  });
</script>
</body>
</html>
